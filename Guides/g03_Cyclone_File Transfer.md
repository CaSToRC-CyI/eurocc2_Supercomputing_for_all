<!--
 g03_Cyclone_File Transfer.md

 CaSToRC, The Cyprus Institute

 (c) 2024 The Cyprus Institute

 Contributing Authors:
 Christodoulos Stylianou (c.stylianou@cyi.ac.cy)
 
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
 
     https://www.apache.org/licenses/LICENSE-2.0
 
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

# **3. File Transfers Between Local and Cyclone**

This guide explains how to transfer files between your local machine and the Cyclone HPC system using `scp` and `rsync`. Both methods are secure and efficient, depending on the size of your data and your needs.

---

## **3.1 Overview of Tools**

### **3.1.1 `scp`: Quick Transfers**
`scp` (Secure Copy Protocol) is a simple command-line tool for transferring files securely over SSH. It’s ideal for small, one-time file transfers. Use `scp` when you need to quickly copy a single file or folder to/from Cyclone.

---

### **3.1.2 `rsync`: Efficient Synchronization**
`rsync` is a more advanced tool for file synchronization. It compares local and remote files, transferring only the changes. Use `rsync` for large data transfers or when frequently updating directories, as it saves bandwidth and time.

---

## **3.2 Cyclone Directory Structure**

When working on Cyclone, your files will be stored in specific directories tailored to different purposes. Each directory has unique performance characteristics and retention policies. It is important to note that **no backups are performed on any of these directories**—it is solely the user's responsibility to maintain their own backups.

---

### **3.2.1 Home Directory**
- **Path**: `/nvme/h/your_username/`
- **Description**: The home directory is your personal space on Cyclone. It is ideal for storing configuration files, scripts, and other small, critical files.
- **Performance**: Moderate I/O performance.
- **Retention**: Persistent storage with no automatic cleanup, but limited in size. Monitor usage to avoid exceeding your quota.
- **Usage Tips**:
  - Store SSH keys, environment setup files, and small codebases.
  - Avoid storing large datasets or temporary files here.

---

### **3.2.2 Scratch Directory**

- **Path**: `/nvme/scratch/your_username/`
- **Description**: The scratch directory is designed for high-performance, temporary storage. It is suitable for active computations and intermediate files generated by jobs.
- **Performance**: High I/O performance optimized for compute-intensive workloads.
- **Retention**: Temporary storage. Files may be deleted after a set period (refer to Cyclone's policies) or when the system requires space.
- **Usage Tips**:
  - Use for large datasets or files generated during computations.
  - Regularly move important results to your home directory or a local backup to prevent data loss.

---

### **3.2.3 Shared Data Directory**

- **Path**: `/onyx/data/project_name/`
- **Description**: Shared project directory available to multiple users within a project. Ideal for collaborative datasets or shared resources.
- **Performance**: Moderate to low I/O performance.
- **Retention**: Persistent storage, but subject to project-specific quotas and policies.
- **Usage Tips**:
  - Collaborate with team members by storing shared input data and results.
  - Ensure file organization and naming conventions are clear for effective collaboration.

---

### **Important Notes**
- **No Backups**: None of these directories are backed up by Cyclone. You must regularly back up your important data to a secure location.
- **Data Responsibility**: It is the user's sole responsibility to maintain copies of critical files. Loss of data in these directories due to system failure or cleanup policies is irreversible.

--- 

## **3.3 Transferring Files**

### **3.3.1 From Local to Cyclone**

#### Using `scp`
```bash
scp /path/to/local/file your_username@cyclone.hpcf.cyi.ac.cy:/path/to/remote/destination/
```
**Example**:  
```bash
scp /home/user/data.csv cstyl@cyclone.hpcf.cyi.ac.cy:/nvme/scratch/cstyl/
```
**Explanation**: This command uploads the file `data.csv` from your local system to the `scratch` directory on Cyclone.

#### Using `rsync`
```bash
rsync -avz /path/to/local/directory your_username@cyclone.hpcf.cyi.ac.cy:/path/to/remote/destination/
```
**Example**:  
```bash
rsync -avz /home/user/project/ cstyl@cyclone.hpcf.cyi.ac.cy:/nvme/scratch/cstyl/project/
```
**Explanation**: This command synchronizes the `project` directory to the `scratch` directory on Cyclone, ensuring only new or updated files are transferred.

---

### **3.3.2 From Cyclone to Local**

#### Using `scp`
```bash
scp your_username@cyclone.hpcf.cyi.ac.cy:/path/to/remote/file /path/to/local/destination/
```
**Example**:  
```bash
scp cstyl@cyclone.hpcf.cyi.ac.cy:/nvme/scratch/cstyl/output.csv /home/user/
```
**Explanation**: This command downloads the file `output.csv` from the Cyclone `scratch` directory to your local machine.

#### Using `rsync`
```bash
rsync -avz your_username@cyclone.hpcf.cyi.ac.cy:/path/to/remote/directory /path/to/local/destination/
```
**Example**:  
```bash
rsync -avz cstyl@cyclone.hpcf.cyi.ac.cy:/nvme/scratch/cstyl/project/ /home/user/project/
```
**Explanation**: This command synchronizes the `project` directory on Cyclone to your local system, transferring only the changes.

---

## **3.4 Notes for Windows Users**

On Windows, you can use `scp` and `rsync` with **PowerShell**, **WSL**, or **Git Bash**. Here’s how to adapt file paths for each:

- **PowerShell**: Use `C:\path\to\local\file`.
- **WSL**: Use `/mnt/c/path/to/local/file`.
- **Git Bash**: Use `/c/path/to/local/file`.

---

### **PowerShell Examples**
```powershell
scp C:\Users\cstylianou\Documents\data.csv cstyl@cyclone.hpcf.cyi.ac.cy:/nvme/scratch/cstyl/
```

---

### **WSL Examples**
```bash
scp /mnt/c/Users/cstylianou/Documents/data.csv cstyl@cyclone.hpcf.cyi.ac.cy:/nvme/scratch/cstyl/
```

---

### **Git Bash Examples**
```bash
scp /c/Users/cstylianou/Documents/data.csv cstyl@cyclone.hpcf.cyi.ac.cy:/nvme/scratch/cstyl/
```

---

### **Additional Notes**
- For large or frequently updated directories, prefer `rsync` over `scp`.
- Use the `-r` option with `scp` to copy directories.
- Use the config file to simplify commands, as explained in [Accessing Cyclone](g02_Cyclone_Accessing.md).
  - For example: `scp C:\Users\cstylianou\Documents\data.csv cyclone:/nvme/scratch/cstyl/`

---
